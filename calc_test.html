<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculus Run: PFD & Divergence</title>
    
    <!-- 1. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Load React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- 3. Load Lucide React (Icons) - Fixed version to prevent UMD errors -->
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.js"></script>

    <!-- 4. Load Babel (to compile JSX in the browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom scrollbar for a "Cyber" feel */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #0891b2; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #06b6d4; 
        }
        /* Remove number input arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-200">

    <!-- The container where React will render -->
    <div id="root"></div>

    <!-- The React Code -->
    <script type="text/babel">
        // --- Get components from global variables (since we aren't using 'import') ---
        const { useState, useEffect, useRef } = React;
        
        // Use a safe fallback if lucideReact fails to load
        const LucideIcons = window.lucideReact || {};
        const { Play, RotateCcw, CheckCircle, XCircle, Trophy, Timer, TrendingUp, Calculator, Brain, User, Keyboard, Volume2 } = LucideIcons;

        // --- Sound FX Utility ---
        const playSound = (type) => {
            // Check for AudioContext support
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            
            osc.connect(gain);
            gain.connect(ctx.destination);
            
            if (type === 'correct') {
                // High pitch, ascending chime
                osc.type = 'sine';
                osc.frequency.setValueAtTime(500, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1000, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                osc.start();
                osc.stop(ctx.currentTime + 0.3);
            } else if (type === 'incorrect') {
                // Low pitch, descending buzz
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(50, ctx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                osc.start();
                osc.stop(ctx.currentTime + 0.3);
            } else if (type === 'click') {
                // Short click
                osc.type = 'square';
                osc.frequency.setValueAtTime(800, ctx.currentTime);
                gain.gain.setValueAtTime(0.05, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.05);
                osc.start();
                osc.stop(ctx.currentTime + 0.05);
            }
        };

        // --- Utility Component for Fractions ---
        const Fraction = ({ num, den }) => (
            <div className="inline-flex flex-col items-center align-middle mx-2 text-lg font-serif">
                <span className="border-b-2 border-slate-400 px-1 pb-0.5 leading-none">{num}</span>
                <span className="pt-0.5 leading-none">{den}</span>
            </div>
        );

        const Summation = ({ term, lower = "n=1", upper = "∞" }) => (
            <div className="inline-flex items-center align-middle mx-2 gap-2">
                <div className="flex flex-col items-center leading-none text-xl">
                <span className="text-xs">{upper}</span>
                <span className="text-3xl font-serif">∑</span>
                <span className="text-xs">{lower}</span>
                </div>
                {term}
            </div>
        );

        const Limit = ({ term, to = "∞" }) => (
            <div className="inline-flex items-center mx-2 gap-1">
                <span className="font-serif italic">lim</span>
                <sub className="text-xs -ml-1">n→{to}</sub>
                {term}
            </div>
        );

        // --- Question Data Pool (20 Questions) ---
        // All PFD questions converted to INPUT type
        const QUESTION_POOL = [
            {
                id: 1,
                category: "PFD Solving",
                type: "input",
                answer: "2",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">Solve for <strong>A</strong> (Untimed):</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700 mb-4">
                    <Fraction num="5x + 5" den="(x - 1)(x + 4)" /> = <Fraction num="A" den="x - 1" /> + <Fraction num="B" den="x + 4" />
                    </div>
                    <p className="text-sm text-slate-400">(Hint: Use the cover-up method with x = 1)</p>
                </div>
                ),
                explanation: "Cover (x-1). Plug x=1 into the rest: (5(1)+5)/(1+4) = 10/5 = 2. Great start, Breezy!"
            },
            {
                id: 2,
                category: "Test for Divergence",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">Evaluate the series using the n-th Term Test for Divergence:</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <Summation term={<Fraction num="n" den="3n + 1" />} />
                    </div>
                </div>
                ),
                options: [
                { id: 'A', label: "Converges" },
                { id: 'B', label: "Diverges" },
                { id: 'C', label: "Inconclusive" },
                { id: 'D', label: "Conditionally Converges" },
                ],
                correctId: 'B',
                explanation: (
                <div className="flex items-center flex-wrap justify-center">
                    Nice work, Breezy. The limit is 1/3 ≠ 0, so it diverges.
                </div>
                )
            },
            {
                id: 3,
                category: "PFD Setup",
                type: "input",
                answer: "3",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">How many unknown constants (A, B, C...) are needed?</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <Fraction num="10" den="x(x^2 + 9)" />
                    </div>
                </div>
                ),
                explanation: "You need A/x for the linear term, and (Bx+C)/(x²+9) for the irreducible quadratic. That's 3 constants total. Spot on!"
            },
            {
                id: 4,
                category: "Test for Divergence",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">What does the Test for Divergence tell us about this series?</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <Summation term={<Fraction num="1" den="n" />} />
                    </div>
                </div>
                ),
                options: [
                { id: 'A', label: "Converges to 0" },
                { id: 'B', label: "Diverges" },
                { id: 'C', label: "Test is Inconclusive" },
                { id: 'D', label: "Converges to 1" },
                ],
                correctId: 'C',
                explanation: (
                <div className="flex items-center flex-wrap justify-center">
                    Be careful, Breezy! The limit is 0, which means the Divergence Test tells us NOTHING.
                </div>
                )
            },
            {
                id: 5,
                category: "PFD Solving",
                type: "input",
                answer: "2",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">Solve for constant <strong>A</strong> (Untimed):</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700 mb-4">
                    <Fraction num="5x - 4" den="(x - 2)(x + 1)" /> = <Fraction num="A" den="x - 2" /> + <Fraction num="B" den="x + 1" />
                    </div>
                    <p className="text-sm text-slate-400">(Hint: Use the cover-up method with x = 2)</p>
                </div>
                ),
                explanation: (
                <div className="flex items-center flex-wrap justify-center">
                    Let x = 2. Cover (x-2). term = 6/3 = 2. Great calculation, Breezy!
                </div>
                )
            },
            {
                id: 6,
                category: "PFD Solving",
                type: "input",
                answer: "4",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">Solve for <strong>B</strong> (the constant over the squared term):</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <Fraction num="x + 1" den="(x - 3)^2" /> = <Fraction num="A" den="x - 3" /> + <Fraction num="B" den="(x - 3)^2" />
                    </div>
                </div>
                ),
                explanation: "Multiply by (x-3)². At x=3, B = 3+1 = 4. Correct!"
            },
            {
                id: 7,
                category: "Test for Divergence",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">Evaluate the limit of the n-th term:</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <Limit term={<Fraction num="n^2" den="2n^2 + 5" />} />
                    </div>
                    <p className="mt-2 text-sm">Does the series diverge?</p>
                </div>
                ),
                options: [
                { id: 'A', label: "Limit = 1/2, Diverges" },
                { id: 'B', label: "Limit = 0, Inconclusive" },
                { id: 'C', label: "Limit = ∞, Diverges" },
                { id: 'D', label: "Limit = 1/2, Converges" },
                ],
                correctId: 'A',
                explanation: "Exactly! The limit is 1/2, which is not 0. Therefore, it diverges."
            },
            {
                id: 8,
                category: "PFD Concept",
                type: "input",
                answer: "4",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">What is the <strong>maximum</strong> degree allowed for the numerator if the denominator is degree 5?</p>
                    <p className="text-sm text-slate-400 mb-2">If it's higher, you must use long division.</p>
                </div>
                ),
                explanation: "Right. The numerator must be strictly less than the denominator. If denom is 5, max num is 4."
            },
            {
                id: 9,
                category: "Test for Divergence",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">Analyze the series using the Divergence Test:</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <Summation term="cos(nπ)" />
                    </div>
                </div>
                ),
                options: [
                { id: 'A', label: "Converges to 0" },
                { id: 'B', label: "Diverges (Oscillates)" },
                { id: 'C', label: "Inconclusive" },
                { id: 'D', label: "Converges to 1" },
                ],
                correctId: 'B',
                explanation: "cos(nπ) alternates between -1 and 1. The limit does not exist, so it diverges. Good eye, Breezy."
            },
            {
                id: 10,
                category: "PFD Solving",
                type: "input",
                answer: "-1",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">Find the value of <strong>B</strong> (Untimed):</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <Fraction num="2" den="(x-1)(x+1)" /> = <Fraction num="A" den="x-1" /> + <Fraction num="B" den="x+1" />
                    </div>
                </div>
                ),
                explanation: "Cover up (x+1), plug in x = -1. You get 2/(-2) = -1. Perfect math, Breezy."
            },
            {
                id: 11,
                category: "PFD Solving",
                type: "input",
                answer: "1",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">Solve for <strong>A</strong> (Untimed):</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <Fraction num="8" den="x^2 - 16" /> = <Fraction num="A" den="x-4" /> + <Fraction num="B" den="x+4" />
                    </div>
                    <p className="text-sm text-slate-400">(Hint: Factor denominator into (x-4)(x+4))</p>
                </div>
                ),
                explanation: "Cover (x-4). Plug x=4 into 8/(x+4) -> 8/8 = 1. Good job!"
            },
            {
                id: 12,
                category: "Test for Divergence",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">Evaluate the limit as n→∞:</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <Limit term={<Fraction num="n!" den="(n+1)!" />} />
                    </div>
                </div>
                ),
                options: [
                { id: 'A', label: "Limit = ∞ (Diverges)" },
                { id: 'B', label: "Limit = 1 (Diverges)" },
                { id: 'C', label: "Limit = 0 (Inconclusive)" },
                { id: 'D', label: "Limit = e" },
                ],
                correctId: 'C',
                explanation: "Expand (n+1)! to (n+1)n!. The limit becomes 1/(n+1) which is 0. Inconclusive! Careful, Breezy."
            },
            {
                id: 13,
                category: "PFD Setup",
                type: "input",
                answer: "3",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">How many total constants are needed?</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <Fraction num="x^2 + 1" den="x(x-1)^2" />
                    </div>
                </div>
                ),
                explanation: "You need A/x, B/(x-1), and C/(x-1)². That's 3 constants. You got this, Breezy."
            },
            {
                id: 14,
                category: "Test for Divergence",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">Does this series diverge by the n-th Term Test?</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <Summation term="e^n" />
                    </div>
                </div>
                ),
                options: [
                { id: 'A', label: "Yes, limit is ∞" },
                { id: 'B', label: "No, limit is 0" },
                { id: 'C', label: "Inconclusive" },
                { id: 'D', label: "Converges" },
                ],
                correctId: 'A',
                explanation: "The terms grow infinitely large. The limit is not 0, so it definitely diverges. Nice one, Breezy."
            },
            {
                id: 15,
                category: "PFD Solving",
                type: "input",
                answer: "1",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">Solve for A (Untimed):</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <Fraction num="7" den="(x-3)(x+4)" /> = <Fraction num="A" den="x-3" /> + <Fraction num="B" den="x+4" />
                    </div>
                </div>
                ),
                explanation: "Let x = 3. Cover (x-3). You get 7/(3+4) = 7/7 = 1. Simple and clean, Breezy."
            },
            {
                id: 16,
                category: "PFD Solving",
                type: "input",
                answer: "1",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">Solve for <strong>A</strong>:</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <Fraction num="1" den="x(x^2+1)" /> = <Fraction num="A" den="x" /> + <Fraction num="Bx+C" den="x^2+1" />
                    </div>
                </div>
                ),
                explanation: "Cover x. Plug x=0 into 1/(x²+1). You get 1/1 = 1."
            },
            {
                id: 17,
                category: "Test for Divergence",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">Evaluate the limit:</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <Limit term={<Fraction num="ln(n)" den="n" />} />
                    </div>
                </div>
                ),
                options: [
                { id: 'A', label: "Limit = 0 (Inconclusive)" },
                { id: 'B', label: "Limit = ∞ (Diverges)" },
                { id: 'C', label: "Limit = 1 (Diverges)" },
                { id: 'D', label: "Limit = -∞" },
                ],
                correctId: 'A',
                explanation: "n grows faster than ln(n). The limit is 0, so the Divergence Test is inconclusive. Stay sharp, Breezy!"
            },
            {
                id: 18,
                category: "PFD Setup",
                type: "input",
                answer: "3",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">How many separate fractions will there be?</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <Fraction num="1" den="(x - 2)(x + 2)^2" />
                    </div>
                </div>
                ),
                explanation: "One for (x-2), one for (x+2), and one for (x+2)². That's 3 terms."
            },
            {
                id: 19,
                category: "Test for Divergence",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">What happens if limit = 0.0000001?</p>
                    <div className="text-sm text-slate-400 mb-2">Assuming that is the exact limit of the nth term.</div>
                </div>
                ),
                options: [
                { id: 'A', label: "Converges" },
                { id: 'B', label: "Diverges" },
                { id: 'C', label: "Inconclusive" },
                { id: 'D', label: "Depends on the sign" },
                ],
                correctId: 'B',
                explanation: "If the limit is NOT EXACTLY zero, it Diverges. 0.0000001 is not 0. Nice logic, Breezy."
            },
            {
                id: 20,
                category: "PFD Solving",
                type: "input",
                answer: "2",
                prompt: (
                <div className="flex flex-col items-center">
                    <p className="mb-4">Solve for <strong>A</strong>:</p>
                    <div className="text-2xl font-bold bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <Fraction num="4" den="x^2 - 1" /> = <Fraction num="A" den="x-1" /> + <Fraction num="B" den="x+1" />
                    </div>
                </div>
                ),
                explanation: "Cover (x-1). Plug x=1 into 4/(x+1) -> 4/2 = 2. You crushed it!"
            }
        ];

        // --- Main App Component ---
        function Calc2Game() {
            const [gameState, setGameState] = useState('start'); // start, playing, end
            const [questions, setQuestions] = useState([]); // The 5 active questions
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [streak, setStreak] = useState(0);
            const [timeLeft, setTimeLeft] = useState(40);
            const [selectedOption, setSelectedOption] = useState(null);
            const [isAnswered, setIsAnswered] = useState(false);
            const [highScore, setHighScore] = useState(0);
            const [inputValue, setInputValue] = useState("");
            const inputRef = useRef(null);

            // Timer Effect
            useEffect(() => {
                let timer;
                // Only count down if not an input question
                const currentQuestion = questions[currentQuestionIndex];
                const isInput = currentQuestion?.type === 'input';

                if (gameState === 'playing' && !isAnswered && timeLeft > 0 && !isInput) {
                    timer = setInterval(() => {
                        setTimeLeft((prev) => prev - 1);
                    }, 1000);
                } else if (timeLeft === 0 && !isAnswered && !isInput) {
                    handleAnswerTimeOut();
                }
                return () => clearInterval(timer);
            }, [gameState, isAnswered, timeLeft, questions, currentQuestionIndex]);

            // Focus input when switching to an input question
            useEffect(() => {
                if (questions[currentQuestionIndex]?.type === 'input' && !isAnswered) {
                    setInputValue("");
                    setTimeout(() => inputRef.current?.focus(), 100);
                }
            }, [currentQuestionIndex, questions, isAnswered]);

            const startGame = () => {
                // Shuffle pool and select 5
                const shuffled = [...QUESTION_POOL].sort(() => 0.5 - Math.random());
                const selectedQuestions = shuffled.slice(0, 5);
                setQuestions(selectedQuestions);

                playSound('click');
                setGameState('playing');
                setCurrentQuestionIndex(0);
                setScore(0);
                setStreak(0);
                setTimeLeft(40);
                setSelectedOption(null);
                setIsAnswered(false);
                setInputValue("");
            };

            const handleAnswer = (optionId) => {
                if (isAnswered) return;
                
                setIsAnswered(true);
                setSelectedOption(optionId);
                
                const question = questions[currentQuestionIndex];
                let correct = false;

                if (question.type === 'input') {
                    // Normalize string comparison
                    correct = optionId.toString().trim().toLowerCase() === question.answer.toString().trim().toLowerCase();
                } else {
                    correct = optionId === question.correctId;
                }
                
                if (correct) {
                    playSound('correct');
                    // Base score 100 + Time Bonus + Streak Bonus
                    // For input questions (untimed), give a fixed bonus equivalent to fast thinking
                    const timeBonus = question.type === 'input' ? 100 : timeLeft * 5;
                    const streakBonus = streak * 50;
                    const points = 100 + timeBonus + streakBonus;
                    setScore(s => s + points);
                    setStreak(s => s + 1);
                } else {
                    playSound('incorrect');
                    setStreak(0);
                }
            };

            const handleAnswerTimeOut = () => {
                playSound('incorrect');
                setIsAnswered(true);
                setSelectedOption('TIMEOUT');
                setStreak(0);
            };

            const handleInputSubmit = (e) => {
                e.preventDefault();
                handleAnswer(inputValue);
            };

            const nextQuestion = () => {
                playSound('click');
                if (currentQuestionIndex < questions.length - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                    setTimeLeft(40);
                    setIsAnswered(false);
                    setSelectedOption(null);
                    setInputValue("");
                } else {
                    endGame();
                }
            };

            const endGame = () => {
                if (score > highScore) setHighScore(score);
                setGameState('end');
            };

            // --- Screens ---

            const StartScreen = () => (
                <div className="flex flex-col items-center justify-center h-full text-center space-y-8 animate-in fade-in zoom-in duration-500">
                <div className="bg-cyan-900/30 p-8 rounded-full ring-4 ring-cyan-500/50 shadow-[0_0_50px_rgba(8,145,178,0.4)]">
                     {Calculator ? <Calculator size={64} className="text-cyan-400" /> : <div className="text-4xl">calc</div>}
                </div>
                <div>
                    <h1 className="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-600">
                        CALCULUS RUN
                    </h1>
                    <div className="flex items-center justify-center gap-2 mt-2 text-cyan-400 font-mono">
                        {User && <User size={18} />}
                        <span>AGENT: BREEZY</span>
                    </div>
                </div>
                <p className="text-slate-400 text-lg max-w-md">
                    Welcome back, Breezy. Your mission: 5 Random Questions. 
                    <br/><br/>
                    <span className="text-sm bg-slate-800 px-2 py-1 rounded text-cyan-300">NOTE:</span> Calculation questions are <strong>UNTIMED</strong> so you can solve them long form.
                </p>
                
                <button 
                    onClick={startGame}
                    className="group relative px-8 py-4 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-xl transition-all hover:scale-105 hover:shadow-[0_0_30px_rgba(8,145,178,0.6)]"
                >
                    <span className="flex items-center gap-2 text-xl">
                    {Play && <Play fill="currentColor" />} START MISSION
                    </span>
                </button>

                {highScore > 0 && (
                    <div className="flex items-center gap-2 text-amber-400 font-mono">
                    {Trophy && <Trophy size={16} />} High Score: {highScore}
                    </div>
                )}
                </div>
            );

            const GameScreen = () => {
                if (!questions || questions.length === 0) return <div>Loading mission data...</div>;

                const question = questions[currentQuestionIndex];
                // For input types, correct checking is done inside the function, 
                // but we need to know if the result was correct for UI color
                const isInput = question.type === 'input';
                
                let isCorrect = false;
                if (isAnswered) {
                    if (isInput) {
                        isCorrect = selectedOption.toString().trim().toLowerCase() === question.answer.toString().trim().toLowerCase();
                    } else {
                        isCorrect = selectedOption === question.correctId;
                    }
                }
                
                return (
                <div className="w-full max-w-3xl mx-auto flex flex-col h-full">
                    {/* HUD */}
                    <div className="flex justify-between items-center mb-6 bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                    <div className="flex items-center gap-2 text-amber-400 font-mono text-xl">
                        {Trophy && <Trophy size={20} />}
                        <span>{score}</span>
                    </div>
                    
                    <div className={`flex items-center gap-2 font-mono text-xl ${!isInput && timeLeft <= 10 ? 'text-red-500 animate-pulse' : 'text-cyan-400'}`}>
                        {Timer && <Timer size={20} />}
                        <span>{isInput ? "PAUSED" : `${timeLeft}s`}</span>
                    </div>
                    
                    <div className="flex items-center gap-2 text-purple-400 font-mono text-xl">
                        {TrendingUp && <TrendingUp size={20} />}
                        <span>x{streak + 1}</span>
                    </div>
                    </div>

                    {/* Progress Bar */}
                    <div className="w-full bg-slate-800 h-2 rounded-full mb-6 overflow-hidden">
                    <div 
                        className="bg-gradient-to-r from-cyan-500 to-blue-500 h-full transition-all duration-500"
                        style={{ width: `${((currentQuestionIndex) / questions.length) * 100}%` }}
                    />
                    </div>

                    {/* Question Card */}
                    <div className="flex-grow flex flex-col items-center">
                    <div className="w-full bg-slate-900 border border-slate-700 p-6 rounded-2xl shadow-xl relative overflow-hidden">
                        <div className="absolute top-0 right-0 p-4 opacity-10">
                        {Brain && <Brain size={120} />}
                        </div>
                        
                        <span className="inline-block px-3 py-1 rounded-full bg-slate-800 text-slate-400 text-xs font-bold tracking-wider mb-4 border border-slate-700">
                        QUESTION {currentQuestionIndex + 1} / {questions.length} • {question.category}
                        </span>
                        
                        <div className="text-xl md:text-2xl text-white font-medium mb-8 z-10 relative">
                        {question.prompt}
                        </div>

                        {/* Input Area or Options Grid */}
                        <div className="w-full z-10 relative">
                            {isInput ? (
                                <form onSubmit={handleInputSubmit} className="flex flex-col gap-4">
                                    <div className="relative">
                                        <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400">
                                            {Keyboard && <Keyboard size={20} />}
                                        </div>
                                        <input 
                                            ref={inputRef}
                                            type="text" 
                                            value={inputValue}
                                            onChange={(e) => setInputValue(e.target.value)}
                                            disabled={isAnswered}
                                            placeholder="Enter value..."
                                            className="w-full pl-10 pr-4 py-4 bg-slate-800 border-2 border-slate-600 rounded-xl focus:border-cyan-500 focus:ring-2 focus:ring-cyan-500/20 text-xl text-white placeholder:text-slate-500 outline-none transition-all"
                                        />
                                    </div>
                                    <button 
                                        type="submit"
                                        disabled={isAnswered || !inputValue}
                                        className="w-full py-4 bg-cyan-600 hover:bg-cyan-500 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold rounded-xl transition-all shadow-lg shadow-cyan-900/20 flex items-center justify-center gap-2"
                                    >
                                        SUBMIT DATA
                                    </button>
                                </form>
                            ) : (
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {question.options.map((opt) => {
                                    let statusClass = "bg-slate-800 border-slate-600 hover:bg-slate-750 hover:border-cyan-500";
                                    
                                    if (isAnswered) {
                                    if (opt.id === question.correctId) {
                                        statusClass = "bg-green-900/50 border-green-500 ring-1 ring-green-500";
                                    } else if (opt.id === selectedOption) {
                                        statusClass = "bg-red-900/50 border-red-500 opacity-50";
                                    } else {
                                        statusClass = "bg-slate-800 border-slate-700 opacity-50";
                                    }
                                    }

                                    return (
                                    <button
                                        key={opt.id}
                                        onClick={() => handleAnswer(opt.id)}
                                        disabled={isAnswered}
                                        className={`p-4 rounded-xl border-2 transition-all duration-200 text-left flex items-center gap-3 ${statusClass}`}
                                    >
                                        <div className="w-8 h-8 rounded-full bg-slate-900 flex items-center justify-center font-bold text-slate-400 text-sm shrink-0">
                                        {opt.id}
                                        </div>
                                        <div className="text-lg font-medium text-slate-200">
                                        {opt.label}
                                        </div>
                                    </button>
                                    );
                                })}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Feedback & Next Button */}
                    {isAnswered && (
                        <div className="mt-6 w-full animate-in slide-in-from-bottom-4 fade-in duration-300">
                        <div className={`p-4 rounded-xl border ${isCorrect ? 'bg-green-900/20 border-green-800' : 'bg-red-900/20 border-red-800'} mb-4`}>
                            <div className="flex items-center gap-2 mb-2">
                            {isCorrect ? (CheckCircle && <CheckCircle className="text-green-500" />) : (XCircle && <XCircle className="text-red-500" />)}
                            <h3 className={`font-bold ${isCorrect ? 'text-green-400' : 'text-red-400'}`}>
                                {isCorrect ? 'Correct!' : `Incorrect. The answer was ${isInput ? question.answer : question.correctId}.`}
                            </h3>
                            </div>
                            <div className="text-slate-300">
                            {question.explanation}
                            </div>
                        </div>
                        
                        <button 
                            onClick={nextQuestion}
                            className="w-full py-4 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-xl transition-colors shadow-lg shadow-cyan-900/20"
                        >
                            {currentQuestionIndex === questions.length - 1 ? "Finish Game" : "Next Question"}
                        </button>
                        </div>
                    )}
                    </div>
                </div>
                );
            };

            const EndScreen = () => (
                <div className="flex flex-col items-center justify-center h-full text-center space-y-6 animate-in zoom-in duration-500">
                <div className="relative">
                    {Trophy && <Trophy size={80} className="text-amber-400 mb-4 drop-shadow-[0_0_15px_rgba(251,191,36,0.5)]" />}
                    <div className="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full animate-bounce">
                    DONE!
                    </div>
                </div>
                
                <h2 className="text-4xl font-bold text-white">Mission Complete, Breezy!</h2>
                
                <div className="grid grid-cols-2 gap-4 w-full max-w-sm mt-8">
                    <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                    <div className="text-slate-400 text-sm uppercase tracking-wider mb-1">Final Score</div>
                    <div className="text-3xl font-mono text-cyan-400 font-bold">{score}</div>
                    </div>
                    <div className="bg-slate-800 p-4 rounded-xl border border-slate-700">
                    <div className="text-slate-400 text-sm uppercase tracking-wider mb-1">Top Streak</div>
                    <div className="text-3xl font-mono text-purple-400 font-bold">{streak}</div>
                    </div>
                </div>

                <p className="text-slate-400 max-w-md mt-4">
                    {score > 2000 ? "Amazing work, Breezy! You're ready for the exam." : 
                    score > 1000 ? "Good job, Breezy! Keep practicing those decompositions." :
                    "Keep reviewing your divergence tests, Breezy!"}
                </p>

                <button 
                    onClick={startGame}
                    className="mt-8 px-8 py-3 bg-slate-700 hover:bg-slate-600 text-white font-bold rounded-xl transition-all flex items-center gap-2"
                >
                    {RotateCcw && <RotateCcw size={20} />} Play Again
                </button>
                </div>
            );

            return (
                <div className="min-h-screen bg-slate-950 text-slate-200 font-sans selection:bg-cyan-500/30">
                <div className="max-w-4xl mx-auto p-4 h-screen flex flex-col">
                    {gameState === 'start' && <StartScreen />}
                    {gameState === 'playing' && <GameScreen />}
                    {gameState === 'end' && <EndScreen />}
                </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Calc2Game />);
    </script>
</body>
</html>
